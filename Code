//FRONTEND//
async function handlePurchase() {
  this.$store.dispatch({ type: 'saveOrder', order: { ...order } })
  socketService.emit('gig-ordered-seller', this.gig)
  eventBusService.emit('show-msg', {
    txt: 'Your Order Is Being Processed',
    type: 'success',
  })
}

//BACKEND//

async function add(order) {
  try {
    let collection = await dbService.getCollection('order')
    let addedOrder = await collection.insertOne(order)
    addedOrder = addedOrder.ops[0]
    addedOrder.createdAt = ObjectId(addedOrder._id).getTimestamp()
    return addedOrder
  } catch (err) {
    logger.error('cannot insert order', err)
    throw err
  }
}

socket.on('gig-ordered', async (gig) => {
  const toSocket = await _getUserSocket(gig.owner._id)
  if (toSocket)
    toSocket.emit(
      'user-ordered-gig',
      `Hey ${gig.owner.username}! \nA user has just ordered one of your gigs right now.`
    )
  return
})
